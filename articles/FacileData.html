<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FacileData API Overview • FacileData</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="FacileData API Overview">
<meta property="og:description" content="FacileData">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FacileData</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/FacileData.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/FacileDataSet-architecture.html">FacileDataSet Architecture</a>
    </li>
    <li>
      <a href="../articles/FacileDataSet-assembly.html">FacileDataSet Assembly</a>
    </li>
    <li>
      <a href="../articles/FacileDataSet.html">FacileDataSet Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/facilebio/FacileData/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="FacileData_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="FacileData_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="FacileData_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>FacileData API Overview</h1>
                        <h4 class="author">Steve Lianoglou</h4>
            
            <h4 class="date">2021-03-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/facilebio/FacileData/blob/master/vignettes/FacileData.Rmd"><code>vignettes/FacileData.Rmd</code></a></small>
      <div class="hidden name"><code>FacileData.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>The <code>FacileData</code> package was written to facilitate easier analysis of large, multi-assay, high-throughput genomics datasets. To this end, the <code>FacileData</code> package provides two things:</p>
<ol style="list-style-type: decimal">
<li>A <em>FacileData Access API</em> that defines a fluent interface over multi-assay genomics datasets that fits into the <a href="https://www.tidyverse.org/">tidyverse</a>. This enables analysts to more naturally query and retrieve data for general exploratory data analysis; and</li>
<li>A reference implementation of a datastore that implements the <em>FacileData Access API</em> called a <em>FacileDataSet</em>. The <code>FacileDataSet</code> provides efficient storage and retrieval of arbitrarily large high-throughput genomics datasets. For example, a single <code>FacileDataSet</code> can be used to store <em>all</em> of the RNA-seq, microarray, RPPA, etc. data from the <a href="https://cancergenome.nih.gov/">The Cancer Genome Atlas</a>. This singular <code>FacileDataSet</code> allows analysts easy access to arbitrary subsets of these data without having to load all of it into memory.</li>
</ol>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>The <a href="http://bioconductor.org/">Bioconductor ecosystem</a> provides a number of data containers, like the <a href="http://bioconductor.org/packages/SummarizedExperiment/"><code>SummarizedExperiment</code></a> to store high-throughput genomics data and the metadata that goes along with it. These containers provide a consistent way for users to access the different aspects of the data that are required to successfully analyze genomics data and have served the community well for a long time, <em>especially</em> in the context of single-experiment projects.</p>
<p>Storing data in these containers, however, is sub-optimal in a few situations:</p>
<ol style="list-style-type: decimal">
<li>When the analyst wants to perform more general exploratory data analysis techniques over the data (like simple scatterplots, boxplots, etc.). When the analyst is contrained by the data access API defined by a SummarizedExperiment, creating simple scatter and boxplots (for exmaple) can become quite tedious; and</li>
<li>When the analyst is analyzing similar data over very large datasets, such as <em>the entirety</em> of the data from <a href="https://cancergenome.nih.gov/">The Cancer Genome Atlas</a> (TCGA), particularly due to the fact that these data containers want to store all of the data in RAM.</li>
</ol>
<p>The fluent and efficient analysis of data from the TCGA poses even more problems since a multitude of assays have been run over each sample, such as RNA-seq, microarrays, exome-seq, etc. With all of this data in hand, analysts may want to look at how gene expression compares to copy number, or miRNA expression, etc.</p>
<p>In these scenarios, a single <code>SummarizedExperiment</code> is no longer up to the task of storing these data since the “feature-space” (rows of the <code>SummarizedExperiment</code>) of all the assays within a singular <code>SummarizedExperiment</code> must be equal.</p>
<p>These problems manifest themselves when we consider even the simplest of analysis scenarios, such as processing an RNA-seq assay into two different feature spaces, (1) gene-level counts; and (2) transcript-level counts. One would have to create two separate <code>SummarizedExperiments</code> with the same columns and <code>colData</code>, but different assay matrices given the different feature-spaces (genes vs. transcripts).</p>
<p>Using a single <code>FacileDataSet</code>, all of these data can be stored in the same data container, and the <em>FacileData API</em> allows analysts to retrieve data from each effortlessly.</p>
<p>Recently, the Bioconductor community has developed the <code>MultiAssayExperiment</code> objet to address many of the same issues the <code>FacileDataSet</code> was built to address. We can consider these complementary efforts, for now. One can imagine using a <code>MultiAssayExperiment</code> as a backend to store these data, and create a thin <code>FacileData</code> API wrapper, to create a <code>FacileMultiAssayExperiment</code>.</p>
</div>
<div id="faciledata-api" class="section level1">
<h1 class="hasAnchor">
<a href="#faciledata-api" class="anchor"></a>FacileData API</h1>
<p>The <em>FacileData API</em> defines a set of query and retrieval functions over multi-assay genomics datasets that fits into the <a href="https://www.tidyverse.org/">tidyverse</a>.</p>
<div class="note">
<p>To provide illustrative examples of the utility of the <em>FacileData API</em>, we rely on the <code>FacileTCGADataSet</code> package, which provides the full RNA-seq expression, miRNA expresion, and copy number data across all 33 indications (11,000+ samples) from the TCGA. Please see the <code>FacileTCGADataSet</code> package for more information regarding how these data were put together, and how to extend it.</p>
</div>
<p>As a teaser, we provide code snippets that show how to plot HER2 copy number vs. expression across the TCGA “BLCA” and “BRCA” indications using the <code>FacileDataSet</code>. We’ll then compare that to how the same code might be written using more traditional bioconductor containers.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/facilebio/FacileData">FacileData</a></span><span class="op">)</span>
<span class="co"># library(FacileTCGADataSet)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="co"># tcga &lt;- FacileTCGADataSet()</span>
<span class="va">tcga</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exampleFacileDataSet.html">exampleFacileDataSet</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu">filter_samples</span><span class="op">(</span><span class="va">tcga</span>, <span class="va">indication</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLCA"</span>, <span class="st">"BRCA"</span><span class="op">)</span><span class="op">)</span>
<span class="va">features</span> <span class="op">&lt;-</span> <span class="fu">filter_features</span><span class="op">(</span><span class="va">tcga</span>, <span class="va">name</span> <span class="op">==</span> <span class="st">"ERBB2"</span><span class="op">)</span>

<span class="va">fdat</span> <span class="op">&lt;-</span> <span class="va">samples</span> <span class="op">%&gt;%</span>
  <span class="fu">with_assay_data</span><span class="op">(</span><span class="va">features</span>, assay_name <span class="op">=</span> <span class="st">"rnaseq"</span>, normalized <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">with_assay_data</span><span class="op">(</span><span class="va">features</span>, assay_name <span class="op">=</span> <span class="st">"cnv_score"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fetch_sample_covariates.html">with_sample_covariates</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"indication"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">fdat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">cnv_score_ERBB2</span>, <span class="va">ERBB2</span>, color<span class="op">=</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">indication</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#example-analysis" class="anchor"></a>Example Analysis</h1>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/facilebio/FacileData">FacileData</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co"># library(FacileTCGADataSet)</span>
<span class="co"># tcga &lt;- FacileTCGADataSet()</span>
<span class="va">tcga</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exampleFacileDataSet.html">exampleFacileDataSet</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">distro</span> <span class="op">&lt;-</span> <span class="fu">samples</span><span class="op">(</span><span class="va">tcga</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fetch_sample_covariates.html">with_sample_covariates</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"indication"</span>, <span class="st">"sample_type"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">distro</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">indication</span>, fill<span class="op">=</span><span class="va">sample_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">90</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="FacileData_files/figure-html/tcga-sample-distribution-1.png" width="700"></p>
</div>
<div id="faciledata-access-api" class="section level1">
<h1 class="hasAnchor">
<a href="#faciledata-access-api" class="anchor"></a>FacileData Access API</h1>
<p>The base interface is the <code>FacileDataStore</code>. There are no objects of this class, it rather serves as an interface that should be implemented by a subclass, i.e. a <code>FacileDataSet</code>, or a <code>FacileSummarizedExperiment</code>. An object that <code>is(x, "FacileDataStore") == TRUE</code> is assumed to implement the entire <em>FacileData API</em>.</p>
<p>Broadly speaking, there are two classes of functions that are used to pull data out of a <code>FacileDataSet</code>, the <code>fetch_*</code> and <code>with_*</code> functions. To a first approximation, we can consider the <code>fetch_*</code> functions to be the lowest level functions, and the <code>with_*</code> functions are higher-level accessors.</p>
<p>The <code>with_*</code> functions were written so that they can naturally be combined in pipe (<code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>) data-manipulation chains. They provide analysts with a fluent and succinct API with which to perform exploratory data analyses.</p>
<p>For example, to retrieve normalized RNA-seq expression values for CXCL9 and GZMA along with survival and sex information for the samples inin the TCGA bladder (“BLCA”) indication, you can write:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu">filter_features</span><span class="op">(</span><span class="va">tcga</span>, <span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CXCL9"</span>, <span class="st">"GZMA"</span><span class="op">)</span><span class="op">)</span>

<span class="va">blca.dat</span> <span class="op">&lt;-</span> <span class="va">tcga</span> <span class="op">%&gt;%</span>
  <span class="fu">filter_samples</span><span class="op">(</span><span class="va">indication</span> <span class="op">==</span> <span class="st">"BLCA"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">with_assay_data</span><span class="op">(</span><span class="va">features</span>, assay_name<span class="op">=</span><span class="st">"rnaseq"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fetch_sample_covariates.html">with_sample_covariates</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OS"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">blca.dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">CXCL9</span>, <span class="va">GZMA</span>, color<span class="op">=</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="FacileData_files/figure-html/quick-blca-example-1.png" width="700"></p>
<div id="function-list" class="section level2">
<h2 class="hasAnchor">
<a href="#function-list" class="anchor"></a>Function list</h2>
<p>Currently the API consists of:</p>
<ul>
<li>filter_features</li>
<li>filter_samples</li>
<li>fetch_assay_data</li>
<li>with_assay_data</li>
<li>fetch_assay_score (x): just use <code><a href="../reference/fetch_assay_data.html">fetch_assay_data(..., aggregate = TRUE)</a></code>
</li>
<li>fetch_custom_sample_covariates (this probably isn’t user facing)</li>
<li>fetch_sample_covariates</li>
<li>with_sample_covariates</li>
<li>fetch_sample_statistics (x)</li>
<li>fetch_samples (x)</li>
</ul>
<p>Functions marked with (x) indicate that this function should be on its way out.</p>
<p>Please see the manpages for these functions for more details.</p>
</div>
<div id="classes" class="section level2">
<h2 class="hasAnchor">
<a href="#classes" class="anchor"></a>Classes</h2>
<ul>
<li>
<code>facile_frame</code>: this works like a <code>tibble</code>, but has a handle to the <code>FacileDataStore</code> that it came from in a slot. We provide <code>.facet_frame</code> implementations for the dplyr and <code><a href="https://rdrr.io/r/base/subset.html">base::subset</a></code> like verbs, as well as <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code> and <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code> so that we can manipulate this as transparently as possible.</li>
</ul>
</div>
</div>
<div id="multiassayexperiment-api-comparsion" class="section level1">
<h1 class="hasAnchor">
<a href="#multiassayexperiment-api-comparsion" class="anchor"></a>MultiAssayExperiment API Comparsion</h1>
<p>Since MAE’s are the closest thing to a datastore that should also easily accomodate the FacileData API, we’d like to compare how similar analyses are done between the two approaches.</p>
<p>Let’s collect MAE use cases in the wild here, and compare ease of data retreival and analysis using between the two.</p>
<ul>
<li>Mini TCGA analysis with MAE from the [Management of genome-scale data section][ph525mae] of the PH525x Biomedical Data Science book by Love et al.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Steve Lianoglou, Vincent Rouilly, Peter Haverty, Denali Therapeutics, Genentech.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
